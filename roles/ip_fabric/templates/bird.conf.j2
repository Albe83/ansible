# BIRD v2 configuration for IP Fabric underlay (OSPF)
# This file is managed by Ansible. Do not edit manually.

log syslog all;
log stderr all;

router id {{ ip_fabric.loopback.ip | default('0.0.0.0') }};

protocol device {
  scan time 10;
}

protocol kernel kernel4 {
  ipv4 {
    import all;
    export where proto = "ospf_underlay_v2";
  };
  scan time 20;
}

protocol direct direct4 {
  ipv4;
}

protocol ospf v2 ospf_underlay_v2 {
  tick 1;
  rfc1583compat yes;

  ipv4 {
    import all;
    export none;
  };

  area 0.0.0.0 {
    {% if ip_fabric.fabrics is defined %}
    {% for fabric in ip_fabric.fabrics %}
    interface "{{ fabric.nic }}" {
      priority {{ fabric.ospf_priority | default(1) }};
    };
    {% endfor %}
    {% endif %}

    stubnet {{ ip_fabric.loopback.ip }}/32;
  };
}
